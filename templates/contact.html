{% extends 'base.html' %} 
{% load static %}
{% block title %} Contact {% endblock %}

{% block extra_head %}
  <!-- any page-specific <head> content: CSS, meta, etc. -->
<style>
    /* Minimal styles if you don't use Bootstrap */
    .alert { padding: 12px 16px; border-radius: 6px; margin-bottom: 12px; position: relative; }
    .alert-success { background: #e6f4ea; border: 1px solid #bfe6c9; color: #1f6d2f; }
    .alert-error { background: #fdecea; border: 1px solid #f2b8b3; color: #721c24; }
    .close-btn { position: absolute; right: 8px; top: 8px; cursor: pointer; background: transparent; border: none; font-size: 1rem; }
    .countdown { font-weight: 600; margin-left: 8px; }
  </style>
{% endblock extra_head %}

{% block content %}

<main class="main-content">
  <div id="django-messages">
    {% if messages %} {% for m in messages %}
    <div
      class="alert {% if m.tags %}alert-{{ m.tags }}{% endif %}"
      data-duration="60"
    >
      <button
        type="button"
        class="close-btn"
        aria-label="Close"
        onclick="dismissMessage(this)"
      >
        ✕
      </button>
      <span class="message-text">{{ m }}</span>
      <span class="countdown" aria-hidden="true"
        >(<span class="seconds">60</span>s)</span
      >
    </div>
    {% endfor %} {% endif %}
  </div>
  <div class="container">
    <div class="breadcrumb">
      <span>Contact</span>
    </div>
  </div>

  <div class="fullwidth-block">
    <div class="container">
      <div class="col-md-5">
        <div class="contact-details">
          <div
            class="map"
            data-latitude="-6.897789"
            data-longitude="107.621735"
          ></div>
          <div class="contact-info">
            <address>
              <img src="{% static "images/icon-marker.png" %}" alt="" />
              <p>
                Weather Hive. <br />
                2025 Avenue Street, Los Angeles
              </p>
            </address>

            <a href="#"
              ><img src="{% static "images/icon-phone.png" %}" alt="" />+1 800 314 235</a
            >
            <a href="#"
              ><img
                src="{% static "images/icon-envelope.png" %}"
                alt=""
              />in@weatherhive.com</a
            >
          </div>
        </div>
      </div>
      <div class="col-md-6 col-md-offset-1">
        <h2 class="section-title">Contact us</h2>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Commodi
          consectetur inventore ducimus, facilis, numquam id soluta omnis eius
          recusandae nesciunt vero repellat harum cum. Nisi facilis odit hic,
          ipsum sed!
        </p>
        <form action="#" class="contact-form" method="POST">
          {% csrf_token %}
          <div class="row">
            <div class="col-md-6">
              <input type="text" name="username" placeholder="Your name..." />
            </div>
            <div class="col-md-6">
              <input type="text" name="email" placeholder="Email Addresss..." />
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <input
                type="text"
                name="companyname"
                placeholder="Company name..."
              />
            </div>
            <div class="col-md-6">
              <input type="text" name="website" placeholder="Website..." />
            </div>
          </div>
          <textarea name="message" placeholder="Message..."></textarea>
          <div class="text-right">
            <input type="submit" placeholder="Send message" />
          </div>
        </form>
      </div>
    </div>
  </div>
</main>
<!-- .main-content -->
{% endblock %}

{% block extra_scripts %}
<script>
  // Dismiss a message when the close button (✕) is clicked
  function dismissMessage(btn) {
    var wrapper = btn.closest(".alert");
    if (wrapper) {
      wrapper.remove();
    }
  }

  // Auto-hide messages after a countdown (default 30 seconds)
  (function () {
    const alerts = document.querySelectorAll("#django-messages .alert");
    alerts.forEach(function (alert) {
      const duration = parseInt(
        alert.getAttribute("data-duration") || "30",
        10
      );
      let seconds = duration;
      const secondsSpan = alert.querySelector(".seconds");
      if (secondsSpan) secondsSpan.textContent = seconds;

      // update countdown every second
      const interval = setInterval(function () {
        seconds -= 1;
        if (secondsSpan) secondsSpan.textContent = seconds;
        if (seconds <= 0) {
          clearInterval(interval);
          if (alert.parentNode) alert.parentNode.removeChild(alert);
        }
      }, 1000);

      // if user clicks the close button, stop the timer
      const closeBtn = alert.querySelector(".close-btn");
      if (closeBtn) {
        closeBtn.addEventListener("click", function () {
          clearInterval(interval);
        });
      }
    });
  })();

  // Cancel button: clear the form and hide any messages immediately
  document.getElementById("cancel-btn").addEventListener("click", function (e) {
    e.preventDefault();
    const form = document.getElementById("contact-form");
    // clear inputs
    Array.from(form.elements).forEach(function (el) {
      if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
        el.value = "";
      }
    });
    // remove messages
    const messagesDiv = document.getElementById("django-messages");
    if (messagesDiv) messagesDiv.innerHTML = "";
  });

  // Optional: client-side required fields check before submit for faster UX
  document
    .getElementById("contact-form")
    .addEventListener("submit", function (e) {
      const name = document.getElementById("id_username").value.trim();
      const email = document.getElementById("id_email").value.trim();
      const message = document.getElementById("id_message").value.trim();
      if (!name || !email || !message) {
        e.preventDefault();
        alert("Please fill out required fields: Name, Email and Message.");
      }
    });
</script>
<script src="{% static 'js/jquery-1.11.1.min.js' %}"></script>
<script src="{% static 'js/plugins.js' %}"></script> 
{% endblock extra_scripts %}

